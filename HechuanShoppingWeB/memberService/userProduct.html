<html>
<head>
    <meta charset="utf-8">
</head>
<body>
<div id="app">
    <div v-if="showProduct">
        <el-form ref="form" :model="sku" label-width="80px">
            <el-form-item label="商品名称">
                <el-input v-model="sku.skuName"></el-input>
            </el-form-item>
            <el-form-item label="商品描述">
                <el-input v-model="sku.skuDesc"></el-input>
            </el-form-item>
            <el-form-item
                    label="价格"
                    prop="price"
                    :rules="[
      { required: true, message: '价格不能为空'},
      { type: 'number', message: '价格必须为数字值'}
    ]"
            >
                <el-input v-model.number="sku.price" autocomplete="off"></el-input>
            </el-form-item>
            <el-form-item label="库存">
                <el-input v-model="sku.stock"></el-input>
            </el-form-item>
            <div v-for="attr in sku.attr">
                <el-form-item :label="attr.attrName">
                    <el-input v-model="attr.attrValue"></el-input>
                </el-form-item>
            </div>

            <el-form-item label="商品封面">

                <el-image :src="sku.skuDefaultImg" style="height: 180px;width: 360px;"></el-image>

            </el-form-item>
            <el-form-item>
                <el-button :plain="true" type="primary" @click="addCar">加入购物车</el-button>
                <el-button @click="back">返回</el-button>

            </el-form-item>
        </el-form>

    </div>
</div>
</body>

<!-- 引入组件库 -->
<script src="../js/axios.min.js"></script>
<link rel="stylesheet" href="../js/elment/http_unpkg.com_element-ui_lib_theme-chalk_index.css">
<script src="../js/vue2.js"></script>
<script src="../js/elment/http_unpkg.com_element-ui_lib_index.js"></script>
<script>
    new Vue({
        el: '#app',
        data: {
            sku: {},
            showProduct: false
        },

        methods: {
            async getProductInfo() {
                let _this = this
                let geturl = window.location.href
                let getqyinfo = geturl.split('?')[1]   //qycode=1001&qyname=%E4%BC%81%E4%B8%9A%E5%BF%99   截取到参数部分
                let getqys = new URLSearchParams('?' + getqyinfo)  //将参数放在URLSearchParams函数中
                let productId = getqys.get('productId')  //获取参数值
                await axios.get('http://127.0.0.1:8888/productService/product/' + productId)
                    .then(response => {
                        _this.sku = response.data.data
                    })
                    .catch(error => {
                        console.log(error)
                    })
                this.showProduct = true
                this.recordUserWatch(this.sku.skuId, this.sku.catalogId)
            },

            recordUserWatch(id, cateId) {
                let _this = this
                let params = {
                    userId: localStorage.getItem('userID') == null ? 0 : localStorage.getItem('userID'),
                    skuId: id,
                    catId: cateId
                }
                axios.post('http://127.0.0.1:8888/productService/pmsRecommendProduct/add', params).then(res => {
                })
            },
            async addCar() {
                let _this = this
                let car = {
                    skuId: this.sku.skuId,
                    userId: localStorage.getItem("userID"),
                    count: 1,
                    price: this.sku.price,
                    name: this.sku.skuName,
                    img: this.sku.skuDefaultImg
                }
                await axios.post('http://localhost:8888/umsMember/umsCar/add', car)
                    .then(response => {
                        this.$message({
                            message: '添加成功',
                            type: 'success'
                        });
                    })
                    .catch(error => {
                        console.log(error)
                    })
            },
            back() {
                window.history.back()
            }


        },
        created() {
            this.getProductInfo()
        }

    })


</script>

</html>
