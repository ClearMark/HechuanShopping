<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
</head>
<style>
    .el-header {
        background-color: #B3C0D1;
        color: #333;
        line-height: 60px;
    }

    .el-table__body-wrapper::-webkit-scrollbar {
        /*width: 0;宽度为0隐藏*/
        width: 0px;
    }

    .demo-table-expand {
        font-size: 0;
    }

    .demo-table-expand label {
        width: 90px;
        color: #99a9bf;
    }

    .demo-table-expand .el-form-item {
        margin-right: 0;
        margin-bottom: 0;
        width: 50%;
    }


    .el-aside {
        color: #333;
    }
</style>
<body style="height: 100%;">
<div id="app">
    <el-container style="height: 1000px; border: 1px solid #eee">
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)">
            <el-menu :default-openeds="['1']">
                <el-submenu index="1">
                    <template slot="title"><i class="el-icon-message"></i>信息管理管理</template>
                    <el-menu-item-group>
                        <el-menu-item index="1-1" @click="mainTypeChange('用户信息管理')">用户管理</el-menu-item>
                        <el-menu-item index="1-2" @click="mainTypeChange('商家信息管理')">商家管理</el-menu-item>
                    </el-menu-item-group>
                </el-submenu>
                <el-submenu index="2">
                    <template slot="title"><i class="el-icon-setting"></i>店铺/订单管理</template>
                    <el-menu-item-group>
                        <el-menu-item index="2-1" @click="mainTypeChange('店铺审核管理')">店铺审核管理</el-menu-item>
                        <el-menu-item index="2-2" @click="mainTypeChange('订单管理')">订单管理</el-menu-item>
                    </el-menu-item-group>
                </el-submenu>
                <el-submenu index="3">
                    <template slot="title"><i class="el-icon-setting"></i>商城管理</template>
                    <el-menu-item-group>
                        <el-menu-item index="3-1" @click="mainTypeChange('商品分类管理')">商品分类管理</el-menu-item>
                        <el-menu-item index="3-2" @click="mainTypeChange('分类属性管理')">分类属性管理</el-menu-item>
                        <el-menu-item index="3-3" @click="mainTypeChange('推荐商品')">推荐商品</el-menu-item>
                    </el-menu-item-group>
                </el-submenu>

            </el-menu>
        </el-aside>
        <el-container>
            <el-header style="text-align: right; font-size: 12px">
                <!--                <el-dropdown>-->
                <!--                    <i class="el-icon-setting" style="margin-right: 15px"></i>-->
                <!--                    <el-dropdown-menu slot="dropdown">-->
                <!--                        <el-dropdown-item>查看</el-dropdown-item>-->
                <!--                        <el-dropdown-item>新增</el-dropdown-item>-->
                <!--                        <el-dropdown-item>删除</el-dropdown-item>-->
                <!--                    </el-dropdown-menu>-->
                <!--                </el-dropdown>-->
                <el-button @click="showAddAdminDialogVisible=true" v-if="showAddAdminButton">添加管理员</el-button>
                <el-button @click="updateAdminPasswordDialogVisible=true">修改密码</el-button>
                <el-dialog
                        :visible.sync="showAddAdminDialogVisible"
                        width="30%"
                >
                    <el-form :model="addAdmin" label-width="100px" class="demo-ruleForm">
                        <el-form-item label="账号">
                            <el-input v-model="addAdmin.username"></el-input>
                        </el-form-item>
                        <el-form-item label="登录密码">
                            <el-input v-model="addAdmin.password"></el-input>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
    <el-button @click="showAddAdminDialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="addAdminIntoDB">添加</el-button>
  </span>
                </el-dialog>
                <el-dialog
                        :visible.sync="updateAdminPasswordDialogVisible"
                        width="30%"
                >
                    <el-form :model="addAdmin" label-width="100px" class="demo-ruleForm">
                        <el-form-item label="旧密码">
                            <el-input v-model="updatePasswordForm.oldPassword"></el-input>
                        </el-form-item>
                        <el-form-item label="新密码">
                            <el-input v-model="updatePasswordForm.newPassword"></el-input>
                        </el-form-item>
                    </el-form>
                    <span slot="footer" class="dialog-footer">
    <el-button @click="updateAdminPasswordDialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="updatePassword">确认</el-button>
  </span>
                </el-dialog>
            </el-header>

            <el-main v-if="mainType=='用户信息管理'">
                <template>
                    <el-form :inline="true" :model="userSearch" class="demo-form-inline">
                        <el-form-item label="用户名">
                            <el-input v-model="userSearch.username" placeholder="用户名"></el-input>
                        </el-form-item>
                        <el-form-item label="电子邮箱">
                            <el-input v-model="userSearch.email" placeholder="电子邮箱"></el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="searchUser">查询</el-button>
                        </el-form-item>
                    </el-form>
                </template>
                <template>
                    <el-table
                            :data="userDataList"
                            style="width: 100%">
                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="手机号码">
                                        <el-input v-model="props.row.mobile"></el-input>
                                    </el-form-item>
                                    <el-form-item label="所在城市">
                                        <el-input v-model="props.row.city"></el-input>
                                    </el-form-item>
                                    <el-form-item label="职业">
                                        <el-input v-model="props.row.job"></el-input>
                                    </el-form-item>
                                    <el-form-item label="个性签名">
                                        <el-input v-model="props.row.sign"></el-input>
                                    </el-form-item>
                                </el-form>
                                <el-button type="primary" @click="savaUser(props.row)">保存</el-button>
                                <el-button type="primary" @click="resetUserPassword(props.row)">重置密码</el-button>
                            </template>
                        </el-table-column>
                        <el-table-column
                                label="用户 ID"
                                prop="id">
                        </el-table-column>
                        <el-table-column
                                label="用户账号"
                                prop="username">
                        </el-table-column>
                        <el-table-column
                                label="电子邮箱"
                                prop="email">
                        </el-table-column>
                        <el-table-column
                                label="注册时间"
                                prop="createTime">
                        </el-table-column>
                    </el-table>
                </template>
                <div class="block">
                    <el-pagination
                            @current-change="userPageChange"
                            layout="prev, pager, next"
                            :total="userTotal">
                    </el-pagination>
                </div>
            </el-main>

            <el-main v-if="mainType=='商家信息管理'">
                <template>
                    <el-form :inline="true" :model="shopSearch" class="demo-form-inline">
                        <el-form-item label="店铺名">
                            <el-input v-model="shopSearch.shopName" placeholder="店铺名"></el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="searchShop">查询</el-button>
                        </el-form-item>
                    </el-form>
                </template>
                <template>
                    <el-table
                            :data="shopDataList"
                            style="width: 100%">
                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="身份证正面">
                                        <el-image
                                                style="width: 100px; height: 100px"
                                                :src="props.row.idCardFront">
                                        </el-image>
                                    </el-form-item>
                                    <el-form-item label="身份证反面">
                                        <el-image
                                                style="width: 100px; height: 100px"
                                                :src="props.row.idCardBack">
                                        </el-image>
                                    </el-form-item>
                                    <el-form-item label="执照正面">
                                        <el-image
                                                style="width: 100px; height: 100px"
                                                :src="props.row.permitFront">
                                        </el-image>
                                    </el-form-item>
                                    <el-form-item label="执照反面">
                                        <el-image
                                                style="width: 100px; height: 100px"
                                                :src="props.row.permitBack">
                                        </el-image>
                                    </el-form-item>
                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column
                                label="店铺ID"
                                prop="id">
                        </el-table-column>
                        <el-table-column
                                label="店铺名"
                                prop="shopName">
                        </el-table-column>
                        <el-table-column
                                label="创建人ID"
                                prop="userId">
                        </el-table-column>
                        <el-table-column
                                label="创建时间"
                                prop="createTime">
                        </el-table-column>
                    </el-table>
                </template>
                <div class="block">
                    <el-pagination
                            @current-change="shopPageChange"
                            layout="prev, pager, next"
                            :total="shopTotal">
                    </el-pagination>
                </div>
            </el-main>

            <el-main v-if="mainType=='店铺审核管理'">
                <template>
                    <el-table
                            :data="checkShopList"
                            border
                            style="width: 50%">
                        <el-table-column
                                fixed
                                prop="shopName"
                                label="店铺名称"
                                width="150">
                        </el-table-column>
                        <el-table-column
                                fixed
                                prop="userId"
                                label="申请人"
                                width="150">
                        </el-table-column>
                        <el-table-column
                                prop="createTime"
                                label="申请日期"
                                width="120">
                        </el-table-column>
                        <el-table-column
                                fixed="right"
                                label="操作"
                                width="100">
                            <template slot-scope="scope">
                                <el-button type="text" size="small" @click="Box(scope.row)">编辑/查看</el-button>
                            </template>

                        </el-table-column>

                    </el-table>
                    <el-dialog
                            title="提示"
                            :visible.sync="checkShopBox"
                            width="50%"
                            :before-close="boxHandleClose">
                        <el-form :model="checkShoping" label-width="100px" class="demo-ruleForm">

                            <el-form-item label="身份证正面">

                                <div>
                                    <el-image :src="checkShoping.idCardFront"
                                              style="height: 180px;width: 360px;"></el-image>
                                </div>
                            </el-form-item>
                            <el-form-item label="身份证反面">

                                <div>
                                    <el-image :src="checkShoping.idCardBack"
                                              style="height: 180px;width: 360px;"></el-image>
                                </div>
                            </el-form-item>
                            <el-form-item label="经营执照正面">

                                <div>
                                    <el-image :src="checkShoping.permitFront"
                                              style="height: 180px;width: 360px;"></el-image>
                                </div>
                            </el-form-item>
                            <el-form-item label="经营执照反面">

                                <div>
                                    <el-image :src="checkShoping.permitBack"
                                              style="height: 180px;width: 360px;"></el-image>
                                </div>
                            </el-form-item>
                        </el-form>


                        <span slot="footer" class="dialog-footer">
    <el-button type="primary" @click="checkShop(1)">通过</el-button>
    <el-button @click="causesBox=true">驳回</el-button>
  </span>
                    </el-dialog>
                    <el-dialog
                            title="提示"
                            :visible.sync="causesBox"
                            width="50%">
                        <el-form :model="checkShoping" label-width="100px" class="demo-ruleForm">
                            <el-form-item label="驳回原因" prop="rejectReason">
                                <el-input type="textarea" v-model="checkShoping.cause"></el-input>
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="checkShop(2)">提交</el-button>
                                <el-button type="primary" @click="causesBox=false">取消</el-button>
                            </el-form-item>

                        </el-form>
                    </el-dialog>
                </template>

            </el-main>

            <el-main v-if="mainType=='订单管理'">
                <template>
                    <el-form :inline="true" class="demo-form-inline">
                        <el-form-item label="订单号">
                            <el-input v-model="orderSearch.orderSn" placeholder="订单号"></el-input>
                        </el-form-item>
                        <el-form-item label="订单状态">
                            <el-select v-model="orderSearch.status" clearable placeholder="订单状态">
                                <el-option label="用户取消" value="用户取消"></el-option>
                                <el-option label="进行中" value="进行中"></el-option>
                                <el-option label="已完成" value="已完成"></el-option>
                                <el-option label="商家取消" value="商家取消"></el-option>
                            </el-select>
                        </el-form-item>
                        <el-form-item label="创建时间">
                            <div class="block">
                                <el-date-picker
                                        v-model="OrderSearchDate"
                                        type="daterange"
                                        range-separator="至"
                                        value-format=“yyyy-MM-dd”
                                        format="yyyy-MM-dd"
                                        start-placeholder="开始日期"
                                        end-placeholder="结束日期"
                                >
                                </el-date-picker>
                            </div>
                        </el-form-item>

                        <el-form-item>
                            <el-button type="primary" @click="orderOnSearch">查询</el-button>
                        </el-form-item>
                    </el-form>

                    <el-table
                            :data="orderList"
                            style="width: 100%">
                        <el-table-column type="expand">
                            <template slot-scope="props">
                                <el-form label-position="left" inline class="demo-table-expand">
                                    <el-form-item label="收货人姓名">
                                        <span>{{ props.row.receiverName }}</span>
                                    </el-form-item>
                                    <el-form-item label="收货人电话">
                                        <span>{{ props.row.receiverPhone }}</span>
                                    </el-form-item>
                                    <el-form-item label="省/直辖市">
                                        <span>{{ props.row.receiverProvince }}</span>
                                    </el-form-item>
                                    <el-form-item label="城市">
                                        <span>{{ props.row.receiverCity }}</span>
                                    </el-form-item>
                                    <el-form-item label="区">
                                        <span>{{ props.row.receiverRegion }}</span>
                                    </el-form-item>
                                    <el-form-item label="详细地址">
                                        <span>{{ props.row.receiverDetailAddress }}</span>
                                    </el-form-item>

                                    <el-form-item label="商品详情">
                                        <el-table
                                                :data="props.row.orderItem"
                                                style="width: 100%">
                                            <el-table-column
                                                    prop="skuName"
                                                    label="商品名称"
                                                    width="150">
                                            </el-table-column>
                                            <el-table-column
                                                    prop="skuPrice"
                                                    label="商品单价"
                                                    width="150">
                                            </el-table-column>
                                            <el-table-column
                                                    prop="skuCount"
                                                    label="商品数量"
                                                    width="150">
                                            </el-table-column>
                                            <el-table-column
                                                    prop="skuImage"
                                                    label="商品图片"
                                                    width="150">
                                                <template slot-scope="scope">
                                                    <el-image :src="scope.row.skuImage"
                                                              style="height: 180px;width: 360px;"></el-image>
                                                </template>
                                            </el-table-column>
                                            <el-table-column
                                                    prop="status"
                                                    label="商品状态"
                                                    width="150">
                                            </el-table-column>
                                        </el-table>
                                    </el-form-item>
                                </el-form>
                            </template>
                        </el-table-column>
                        <el-table-column
                                label="订单号"
                                prop="orderSn">
                        </el-table-column>
                        <el-table-column
                                label="创建时间"
                                prop="createTime">
                        </el-table-column>
                        <el-table-column
                                label="总金额"
                                prop="totalAmount">
                        </el-table-column>
                        <el-table-column
                                label="订单状态"
                                prop="status">
                        </el-table-column>
                    </el-table>
                    <template>
                        <el-pagination
                                @current-change="orderCurrentPageChange"
                                layout="prev, pager, next"
                                :total="orderTotal">
                        </el-pagination>
                    </template>
                </template>
            </el-main>

            <el-main v-if="mainType=='商品分类管理'">

                <template>
                    <div>
                        <el-tree
                                :data="tableData"
                                :props="defaultProps"
                                :expand-on-click-node="false"
                                node-key="catId"
                                :default-expanded-keys="expandedKeys"
                        >
                         <span class="custom-tree-node" slot-scope="{ node, data }">
        <span>{{ node.label }}</span>
        <span>
          <el-button
                  v-if="node.level <=2"
                  type="text"
                  size="mini"
                  @click="() => append(data)">
            添加子分类
          </el-button>
            <el-button
                    v-if="node.childNodes.length===0"
                    type="text"
                    size="mini"
                    @click="() => remove(node, data)">
            删除该分类
          </el-button>
        </span>
      </span>
                        </el-tree>
                        <el-dialog
                                title="提示"
                                :visible.sync="dialogVisible"
                                width="30%"
                        >
                            <el-form :model="category">
                                <el-form-item label="分类名称">
                                    <el-input v-model="category.name" autocomplete="off"></el-input>
                                </el-form-item>
                            </el-form>
                            <span slot="footer" class="dialog-footer">
    <el-button @click="dialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="addCategory()">确 定</el-button>
  </span>
                        </el-dialog>
                    </div>


                </template>

            </el-main>

            <el-main v-if="mainType=='分类属性管理'">
                <template>
                    <div class="block">
                        <el-cascader
                                placeholder="搜索指定分类属性"
                                :options="attrOptions"
                                v-model="caseValue"
                                filterable></el-cascader>
                        <el-button type="primary" icon="el-icon-search" @click="searchCategoryAttrByCategoryId">搜索
                        </el-button>
                        <el-button type="primary" @click="addAttrDialog = true">添加新属性</el-button>
                    </div>
                    <el-dialog
                            title="提示"
                            :visible.sync="addAttrDialog"
                            width="30%"
                            :before-close="handleClose">
                        <el-form :model="newAttr" class="demo-form-inline">
                            <el-form-item label="选择分类">
                                <el-cascader
                                        placeholder="搜索指定分类属性"
                                        :options="attrOptions"
                                        v-model="addSelectValue"
                                        filterable></el-cascader>
                            </el-form-item>
                            <el-form-item label="属性名">
                                <el-input v-model="newAttr.attrName" placeholder="属性名"></el-input>
                            </el-form-item>


                        </el-form>

                        <span slot="footer" class="dialog-footer">
    <el-button @click="addAttrDialog = false">取 消</el-button>
    <el-button type="primary" @click="addNewAttr">添加</el-button>
  </span>
                    </el-dialog>
                    <el-table
                            :data="categoryAttrList"
                            border
                            style="width: 50%">
                        <el-table-column
                                fixed
                                prop="attrId"
                                label="ID"
                                width="150">
                        </el-table-column>
                        <el-table-column
                                fixed
                                prop="attrName"
                                label="属性名称"
                                width="150">
                        </el-table-column>
                        <el-table-column
                                prop="categoryName"
                                label="所属分类"
                                width="120">
                        </el-table-column>
                        <el-table-column
                                fixed="right"
                                label="操作"
                                width="100">
                            <template slot-scope="scope">
                                <el-button :plain="true" @click="deleteAttr(scope.row)" type="text" size="small">删除
                                </el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </template>
            </el-main>

            <el-main v-if="mainType=='推荐商品'">
                <template>
                    <el-form :inline="true" :model="skuHotSearch" class="demo-form-inline">
                        <el-form-item label="商品名">
                            <el-input v-model="skuHotSearch.skuName" placeholder="商品名"></el-input>
                        </el-form-item>
                        <el-form-item>
                            <el-button type="primary" @click="searchSkuHot">查询</el-button>
                        </el-form-item>
                    </el-form>
                </template>

                <template>
                    <el-table
                            :data="skuHotDataList"
                            border
                            style="width: 100%; height: auto">
                        <el-table-column
                                prop="skuDefaultImg"
                                label="商品图片"
                                width="180">
                            <template slot-scope="scope">
                                <img :src="scope.row.skuDefaultImg" style="width: 50px;height: 50px">
                            </template>
                        </el-table-column>
                        <el-table-column
                                prop="skuName"
                                label="商品名称"
                                width="180">
                        </el-table-column>
                        <el-table-column
                                prop="price"
                                label="商品价格">
                        </el-table-column>
                        <el-table-column
                                prop="saleCount"
                                label="销量">
                        </el-table-column>
                        <el-table-column
                                prop="hot"
                                label="热度">
                        </el-table-column>
                        <el-table-column
                                fixed="right"
                                label="操作"
                                width="100">
                            <template slot-scope="scope">
                                <el-button type="text" size="small" @click="showSkuHotDialog(scope.row)">设置热度
                                </el-button>
                                <el-button type="text" size="small" @click="takeDownProduct(scope.row.skuId)">下架商品
                                </el-button>
                            </template>
                            <el-pagination
                                    @current-change="skuHotPageChange"
                                    layout="prev, pager, next"
                                    :total="skuHotTotal">
                            </el-pagination>

                        </el-table-column>

                    </el-table>
                    <el-dialog
                            title="提示"
                            :visible.sync="skuHotDialogVisible"
                            width="30%"
                    >
                        <span>选中商品热度</span>
                        <template>
                            <el-select v-model="hot" placeholder="请选择">
                                <el-option
                                        v-for="item in options"
                                        :key="item.value"
                                        :label="item.value"
                                        :value="item.value">
                                </el-option>
                            </el-select>
                        </template>
                        <span slot="footer" class="dialog-footer">
    <el-button @click="skuHotDialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="setHot">确 定</el-button>
  </span>
                    </el-dialog>
                </template>
            </el-main>

        </el-container>

    </el-container>
</div>

</body>
<script src="../js/axios.min.js"></script>
<link rel="stylesheet" href="../js/elment/http_unpkg.com_element-ui_lib_theme-chalk_index.css">
<script src="../js/vue2.js"></script>
<script src="https://unpkg.com/vue-infinite-loading@^2/dist/vue-infinite-loading.js"></script>
<!-- 引入组件库 -->
<script src="../js/elment/http_unpkg.com_element-ui_lib_index.js"></script>
<script>
    console.log(localStorage.getItem('adminId'))


</script>
<script>
    new Vue({
        el: '#app',
        data: {
            updateAdminPasswordDialogVisible: false,
            updatePasswordForm: {
                id: localStorage.getItem('adminId'),
                oldPassword: '',
                newPassword: '',
            },
            addAdmin: {},
            showAddAdminDialogVisible: false,
            userTotal: 0,
            orderList: [],
            orderTotal: 0,
            OrderSearchDate: [],
            showAddAdminButton: false,
            options: [
                {value: '1'},
                {value: '2'},
                {value: '3'},
                {value: '4'},
                {value: '5'},
            ],
            hot: '',
            skuHotDialogVisible: false,
            isLoad: true,
            orderSearch: {
                createTimeBegin: '',
                createTimeEnd: '',
                orderSn: '',
                status: '',
                pageNum: 1,
                pageSize: 10,
            },

            userDataList: [],
            checkShopList: [],
            addAttrDialog: false,
            mainType: '用户添加',
            tableData: [],
            causesBox: false,
            checkShopBox: false,
            checkShoping: {},
            category: {},
            nowSkuHot: {},
            caseValue: [],
            skuHotDataList: [],
            newAttr: {},
            categoryAttrList: [],
            dialogVisible: false,
            expandedKeys: [],
            defaultProps: {
                children: 'children',
                label: 'name'
            },
            attrOptions: [],
            categoryAttrPage: {
                pageNum: 1,
                pageSize: 10,
                total: 0,
            },
            currentPage: 1,
            userSearch: {
                username: '',
                email: '',
                pageNum: 1,
                pageSize: 10,
            },
            shopDataList: [],
            shopTotal: 0,
            shopSearch: {
                shopName: '',
                pageNum: 1,
                pageSize: 10,
            },

            skuHotTotal: 0,
            skuHotSearch: {
                skuName: '',
                pageNum: 1,
                pageSize: 10,
            },


            addSelectValue: [],

            //    商品分类单独有
            pmsCategory: {
                name: '',
                catLevel: '',
                // parentId: '',
                // showStatus: '',
                // sort: '',
                // icon: '',
                // keywords: '',
                // description: '',
            },

        },

        methods: {

            resetUserPassword(item) {
                let _this = this;
                axios.get('http://127.0.0.1:8888/umsMember/reset/password/' + item.id).then(function (response) {
                    console.log(response.data)
                    if (response.data.code === 8888) {
                        _this.$alert('新密码:' + response.data.data, '标题名称', {
                            confirmButtonText: '复制',
                            callback: action => {
                                _this.copy(response.data.data)
                                this.$message({
                                    type: 'info',
                                    message: `action: ${action}`
                                });
                            }
                        });
                    }
                }).catch(function (error) {
                    console.log(error);
                });
            },

            takeDownProduct(skuId) {
                let _this = this;
                axios.get('http://127.0.0.1:8888/productService/product/takeDownProduct/' + skuId).then(function (response) {
                    console.log(response.data)
                    if (response.data.code === 8888) {
                        _this.$message({
                            message: '下架成功',
                            type: 'success'
                        });
                        _this.getSkuHotDataList();
                    } else {
                        _this.$message({
                            message: '下架失败',
                            type: 'error'
                        });
                    }
                }).catch(function (error) {
                    console.log(error);
                });
            },

            userPageChange(page) {

                this.userSearch.pageNum = page;
                this.getUserDataList();
            },

            skuHotPageChange(page) {
                this.skuHotSearch.pageNum = page;
                this.getSkuHotDataList();
            },

            shopPageChange(page) {

                this.shopSearch.pageNum = page;
                this.getShopDataList();
            },

            searchUser() {
                this.userSearch.pageNum = 1;
                this.getUserDataList();
            },
            searchSkuHot() {
                this.skuHotSearch.pageNum = 1;
                this.getSkuHotDataList();
            },
            searchShop() {
                this.userSearch.pageNum = 1;
                this.getShopDataList();
            },

            async savaUser(item) {
                let _this = this;

                await axios.post('http://127.0.0.1:8888/umsMember/updateMemberInfo', item, {}).then(function (response) {
                    _this.$message({
                        message: '修改成功',
                        type: 'success'
                    });
                }).catch(function (error) {
                    console.log(error);
                });
            },
            orderOnSearch() {
                if (this.OrderSearchDate.length > 0) {
                    this.orderSearch.createTimeBegin = (this.OrderSearchDate[0]).substring(1, 11);
                    this.orderSearch.createTimeEnd = (this.OrderSearchDate[1]).substring(1, 11);
                }
                this.orderSearch.pageNum = 1;
                this.getOrderList();
            },

            orderCurrentPageChange(page) {
                this.orderSearch.pageNum = page;
                this.getOrderList();
            },

            showSkuHotDialog(row) {
                this.nowSkuHot = row;
                this.skuHotDialogVisible = true;
            },

            Box(shops) {
                this.checkShoping = shops;
                this.checkShopBox = true;
            },

            setHot() {
                let _this = this;
                this.skuHotDialogVisible = false;
                this.nowSkuHot.hot = this.hot;
                axios.post('http://127.0.0.1:8888/productService/pmsSkuInfo/setHot', this.nowSkuHot).then(function (response) {
                    _this.$message({
                        message: '修改成功',
                        type: 'success'
                    });
                }).catch(function (error) {
                    console.log(error);
                });
            },

            async getSkuHotDataList() {
                let _this = this;

                await axios.post('http://127.0.0.1:8888/productService/pmsSkuInfo/skuHot', this.skuHotSearch)
                    .then(function (response) {
                        console.log(response);
                        if (response.data.code == 8888) {


                            _this.skuHotDataList = response.data.data;
                            _this.skuHotDataTotal = response.data.total;

                        } else {
                            _this.$message.error(response.data.message);
                        }
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },

            boxHandleClose(done) {
                this.$confirm('确认关闭？')
                    .then(_ => {
                        done();
                    })
                    .catch(_ => {
                    });
            },


            getTableData(row) {
                switch (row) {
                    case '商品分类管理':
                        this.getCategoryList();
                        break;
                    case '分类属性管理':
                        this.loadCategoryAttrList();
                        this.getCategoryAttrList();
                        break;
                    case '用户信息管理':
                        this.getUserDataList();
                        break;
                    case '商家信息管理':
                        this.getShopDataList();
                        break;
                    case '店铺审核管理':
                        this.getCheckShopList();
                        break;
                    case '推荐商品':
                        this.getSkuHotDataList();
                        break;
                    case '订单管理':
                        this.getOrderList();
                        break;
                }
            },
            deleteAttr(row) {
                let _this = this;
                axios.delete('http://127.0.0.1:8888/productService/pmsAttr/' + row.attrId)
                    .then(function (response) {
                        console.log(response);
                        if (response.data.code == 8888) {
                            _this.$message({
                                message: '删除成功',
                                type: 'success'
                            });
                            _this.getCategoryAttrList()
                        }
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            addNewAttr() {

                let _this = this;
                console.log('添加新属性')
                this.newAttr.catelogId = this.addSelectValue[2];
                this.newAttr.enable = 1;
                axios.post('http://127.0.0.1:8888/productService/pmsAttr', this.newAttr)
                    .then(function (response) {
                        console.log(response);
                        if (response.data.code == 8888) {
                            _this.$message({
                                type: 'success',
                                message: '添加成功!'
                            });
                            _this.addAttrDialog = false;
                            _this.getCategoryAttrList();
                        } else {
                            _this.$message({
                                type: 'error',
                                message: '添加失败!'
                            });
                        }
                    })
                    .catch(function (error) {
                        console.log(error);
                    });


            },
            addCategory() {
                let now = this;
                console.log('添加分类')
                console.log(this.category)
                const url = 'http://localhost:8888/productService/pmsCategory';
                axios.post(url, this.category)
                    .then(response => {
                        if (response.data.code === 8888) {
                            this.$message({
                                type: 'success',
                                message: '添加成功!'
                            });
                            now.getCategoryList();
                            now.dialogVisible = false

                            // _this.expandedKeys = [data.catId];
                        } else {
                            this.$message({
                                type: 'error',
                                message: '添加失败!'
                            });
                        }
                    })
                    .catch(function (error) {
                        console.log(error);
                    });


            },
            getCategoryList() {
                let _this = this;
                const url = 'http://127.0.0.1:8888/productService/pmsCategory';
                axios.get(url)
                    .then(response => {
                        console.log(11)
                        console.log(response.data)
                        _this.tableData = response.data.data;
                        console.log(_this.tableData)
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            mainTypeChange(str) {
                this.mainType = str;
                this.getTableData(str);
            },
            append(data) {
                console.log(data)
                this.category.catLevel = data.catLevel + 1 > 3 ? 3 : data.catLevel + 1;
                this.category.parentCid = data.catId;
                this.category.showStatus = 1;

                this.dialogVisible = true;

                console.log(this.category)

            },
            remove(node, data) {
                let ids = [data.catId];
                this.$confirm(`此操作将永久删除该文件 【${data.name}】 是否继续?`, '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    const url = 'http://localhost:8888/productService/pmsCategory/removeCategoryById';
                    axios.post(url, ids)
                        .then(response => {
                            if (response.data.code === 8888) {
                                this.$message({
                                    type: 'success',
                                    message: '删除成功!'
                                });
                                this.getCategoryList();
                                this.expandedKeys = [node.parent.data.catId];
                            } else {
                                this.$message({
                                    type: 'error',
                                    message: '删除失败!'
                                });
                            }
                        })
                        .catch(function (error) {
                            console.log(error);
                        });

                }).catch(() => {

                });


            },
            getCategoryAttrList() {
                let _this = this;
                const number = this.categoryAttrPage.pageNum <= 1 ? 1 : this.categoryAttrPage.pageNum;
                axios.get('http://127.0.0.1:8888/productService/pmsAttr/page/' + number)
                    .then(response => {
                        console.log(response.data)
                        _this.categoryAttrList = response.data.data;
                        console.log(_this.categoryAttrList)
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            searchCategoryAttrByCategoryId() {
                let _this = this;
                const catId = this.caseValue[2];
                axios.get('http://127.0.0.1:8888/productService/pmsAttr//getCategoryAttr/' + catId)
                    .then(response => {
                        console.log(response.data)
                        _this.categoryAttrList = response.data.data;
                        console.log(_this.categoryAttrList)
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            checkShop(status) {
                let _this = this;
                this.checkShoping.status = status;
                axios.post('http://127.0.0.1:8888/umsMember/umsShopNotCheck/checkShop', this.checkShoping)
                    .then(response => {
                        _this.getCheckShopList();
                        _this.causesBox = false
                        _this.checkShopBox = false
                        _this.$message({
                            type: 'success',
                            message: '操作成功 !'
                        });
                    })
                    .catch(function (error) {
                        console.log(error);
                    });

            },
            getUserDataList() {
                let _this = this;
                axios.post('http://127.0.0.1:8888/umsMember/queryAll', this.userSearch)
                    .then(response => {
                        _this.userDataList = response.data.data;
                        _this.userTotal = response.data.total;
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            async getCheckShopList() {
                console.log('获取待审核店铺列表')
                let _this = this;
                await axios.get('http://127.0.0.1:8888/umsMember/umsShopNotCheck/allNotCheck').then(response => {
                    _this.checkShopList = response.data.data;
                    console.log(_this.checkShopList)
                }).catch(function (error) {
                    console.log(error);
                });
            },

            getOrderList() {
                let _this = this;
                axios.post('http://127.0.0.1:8888/productService/pmsOrder/queryAdmin', this.orderSearch)
                    .then(response => {
                        console.log(response.data)
                        _this.orderList = response.data.data;
                        _this.orderTotal = response.data.total;
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            async loadCategoryAttrList() {
                let _this = this;
                await axios.get('http://127.0.0.1:8888/productService/pmsCategory/case')
                    .then(function (response) {
                        console.log('解析请求')
                        var data = response.data;
                        if (data.code == 8888) {
                            _this.attrOptions = data.data;
                        } else {
                        }
                    }).catch(function (error) {

                    });

            },
            getShopDataList() {
                let _this = this;
                axios.post('http://127.0.0.1:8888/umsMember/umsShop/queryAll', this.shopSearch)
                    .then(response => {
                        _this.shopDataList = response.data.data;
                        _this.shopTotal = response.data.total;
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            addAdminIntoDB() {
                let _this = this;
                this.addAdmin.parentId = localStorage.getItem('adminId');
                axios.post('http://127.0.0.1:8888/umsMember/umsAdmin/add', this.addAdmin)
                    .then(response => {
                        _this.showAddAdminDialogVisible = false
                        _this.$message({
                            type: 'success',
                            message: '操作成功 !'
                        });
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            updatePassword() {
                let _this = this;
                axios.post('http://127.0.0.1:8888/umsMember/umsAdmin/edit/password', this.updatePasswordForm)
                    .then(response => {
                        _this.updateAdminPasswordDialogVisible = false
                        _this.$message({
                            type: 'success',
                            message: response.data.data
                        });
                    })
                    .catch(function (error) {
                        console.log(error);
                    });
            },
            copy(data) {
                let url = data;
                let oInput = document.createElement('input');
                oInput.value = url;
                document.body.appendChild(oInput);
                oInput.select(); // 选择对象;
                console.log(oInput.value)
                document.execCommand("Copy"); // 执行浏览器复制命令
                this.$message({
                    message: '复制成功',
                    type: 'success'
                });
                oInput.remove()
            },
        },
        created() {
            if (localStorage.getItem('adminId') === null) {
                alert("请先登录")
                window.location.href = "../memberService/adminLogin.html";
            }
            if (localStorage.getItem('adminId') == 1) {
                this.showAddAdminButton = true;
            }
            this.loadCategoryAttrList();
        },


    })


</script>

</html>
